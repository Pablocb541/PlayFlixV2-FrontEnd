<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edición de Videos por Playlist</title>
  <link rel="stylesheet" href="../Styles/CrudVideos.css">
  <link rel="stylesheet" href="../Styles/admin.css">
</head>
<body>
  <header class="navbar">
    <div class="container-navbar">
        <h1>Panel de Administrador</h1>
        <nav class="navbar-nav">
            <ul class="navbar-list">
                <a href="Inicio.html">Perfiles</a>
                <a href="crearPerfiles.html">Gestión de Perfiles</a>
                <a href="crearVideos.html">Gestión de Videos</a>
                <a href="login.html">Cerrar Sesión</a>
            </ul>
        </nav>
    </div>
  </header>

  <div class="container">
    <h1>Edición de Videos por Playlist</h1>
    
    <!-- Selección de Playlist -->
    <label for="playlistSelect">Seleccione una Playlist:</label>
    <select id="playlistSelect" onchange="loadVideos()">
      <!-- Opciones de playlists se cargarán dinámicamente -->
    </select>

    <!-- Lista de videos para la Playlist seleccionada -->
    <h2>Videos de la Playlist</h2>
    <ul id="videosList"></ul> 
  </div>

  <script>
    // Obtener referencias a los elementos del DOM
    const playlistSelect = document.getElementById('playlistSelect');
    const videosList = document.getElementById('videosList');

    // Obtener el ID del usuario del localStorage
const userId = localStorage.getItem('userId');

// Función para cargar las playlists disponibles
async function cargarPlaylists() {
  try {
    // Realizar una solicitud GET para obtener las playlists del usuario
    const response = await fetch(`http://localhost:3000/api/playlists?userId=${userId}`);
    const playlists = await response.json();

    // Limpiar el combobox de playlists antes de agregar nuevas opciones
    playlistSelect.innerHTML = '';
    // Iterar sobre cada playlist y crear opciones para el combobox
    playlists.forEach(playlist => {
      const option = document.createElement('option');
      option.value = playlist._id;
      option.textContent = playlist.name;
      playlistSelect.appendChild(option);
    });
  } catch (error) {
    console.error('Error al cargar playlists:', error);
  }
}

    // Función para cargar los videos asociados a la playlist seleccionada
    async function loadVideos() {
      try {
        // Obtener el ID de la playlist seleccionada
        const playlistId = playlistSelect.value;
        // Realizar una solicitud GET para obtener los videos asociados a la playlist
        const response = await fetch(`http://localhost:3000/api/playlists/${playlistId}/videos`);
        const videos = await response.json();
        
        // Limpiar la lista de videos antes de agregar nuevos elementos
        videosList.innerHTML = '';
        // Iterar sobre cada video y crear elementos HTML para mostrarlos en la lista
        videos.forEach(video => {
          const listItem = document.createElement('li');
          // Crear el contenido del elemento de lista con información del video y botones de acción
          listItem.innerHTML = `
            <div class="video-info">
              <strong>${video.name}</strong> - <a href="${video.youtubeUrl}" target="_blank">Ver en YouTube</a>
            </div>
            <div class="video-actions">
              <button onclick="editarVideo('${video._id}', '${video.name}', '${video.youtubeUrl}')">Editar</button>
              <button onclick="eliminarVideo('${video._id}')">Eliminar</button>
            </div>
          `;
          // Agregar el elemento de lista a la lista de videos
          videosList.appendChild(listItem);
        });
      } catch (error) {
        console.error('Error al cargar los videos:', error);
      }
    }

    // Función para editar un video
    function editarVideo(id, nombre, url) {
      // Implementa la lógica para editar un video aquí
      console.log('Editar video:', id, nombre, url);
    }

    // Función para eliminar un video
    async function eliminarVideo(id) {
      // Confirmar si el usuario está seguro de eliminar el video
      if (confirm('¿Estás seguro de que deseas eliminar este video?')) {
        try {
          // Realizar una solicitud DELETE para eliminar el video con el ID proporcionado
          const response = await fetch(`http://localhost:3000/api/videos/${id}`, {
            method: 'DELETE'
          });
          // Verificar si la respuesta del servidor es exitosa
          if (response.ok) {
            loadVideos(); // Volver a cargar la lista de videos
          } else {
            console.error('Error al eliminar el video:', response.statusText);
          }
        } catch (error) {
          console.error('Error al eliminar el video:', error);
        }
      }
    }

    cargarPlaylists(); // Cargar playlists al cargar la página
  </script>
</body>
</html>
